<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Universal Checklist â€” Movies & Novels (Synced)</title>
<style>
  :root{
    --bg:#071028; --card:#081726; --accent:#7dd3fc; --muted:#9fb0c2;
  }
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#071028 0%, #041021 100%);color:#eaf6ff}
  .wrap{max-width:920px;margin:14px auto;padding:12px}
  .tabs{display:flex;border-radius:12px;overflow:hidden;box-shadow:0 6px 18px rgba(2,6,23,.6)}
  .tab{flex:1;padding:12px;text-align:center;cursor:pointer;background:var(--card);color:var(--muted);font-weight:700}
  .tab.active{background:#07253a;color:white}
  .container{padding:14px}
  .group{margin-top:12px;background:linear-gradient(180deg,rgba(255,255,255,.02),transparent);padding:12px;border-radius:10px}
  .group-title{display:flex;justify-content:space-between;align-items:center;color:var(--accent);font-weight:700}
  ul.checklist{list-style:none;padding:0;margin:8px 0}
  li.item{display:flex;align-items:center;gap:12px;padding:8px;border-radius:8px;margin-bottom:8px;background:rgba(255,255,255,.01)}
  input[type=checkbox]{width:20px;height:20px;accent-color:var(--accent)}
  label.item-label{flex:1}
  .add-row{display:flex;gap:8px;margin-top:10px}
  input[type=text]{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,.04);background:transparent;color:inherit}
  button{background:transparent;border:1px solid rgba(255,255,255,.04);color:var(--accent);padding:8px 10px;border-radius:8px;font-weight:700;cursor:pointer}
  button.ghost{border-style:dashed;color:var(--muted)}
  .small{font-size:13px;color:var(--muted)}
  .actions{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
  .danger{border-color:#8b2b2b;color:#ffb3b3}
</style>
</head>
<body>
  <div class="wrap">
    <h2>Universal Checklist</h2>

    <div class="tabs">
      <div class="tab active" data-tab="movies">ðŸŽ¬ Movies</div>
      <div class="tab" data-tab="novels">ðŸ“š Novels</div>
    </div>

    <div class="container" id="app">
      <div class="actions">
        <button id="checkAll">Check all</button>
        <button id="uncheckAll">Uncheck all</button>
      </div>

      <div id="content"></div>

      <div class="add-row">
        <input id="newSeries" type="text" placeholder="Add new series to active tab...">
        <button id="addSeriesBtn">Add Series</button>
      </div>
    </div>
  </div>

<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

<script>
/* ========= YOUR FIREBASE CONFIG ========= */

const firebaseConfig = {
    apiKey: "AIzaSyBVxEWfNXIVvcTRmhhEms0TY2G3clbXuZs",
    authDomain: "checklist-eeb85.firebaseapp.com",
    projectId: "checklist-eeb85",
    storageBucket: "checklist-eeb85.appspot.com",
    messagingSenderId: "390982627640",
    appId: "1:390982627640:web:ed01d655b2ba7640e5d1cd",
    measurementId: "G-P6YEE8T6MC"
};

/* ======================================== */

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let activeTab = "movies";

/* ========= FULL RIORDAN + SH LIST ========= */

const defaultNovels = [
  { name: "Kane Chronicles", items: [
    "The Red Pyramid","The Throne of Fire","The Serpentâ€™s Shadow"
  ]},
  { name: "Percy Jackson & the Olympians", items: [
    "The Lightning Thief","The Sea of Monsters","The Titanâ€™s Curse","The Battle of the Labyrinth","The Last Olympian"
  ]},
  { name: "PJO Extras", items: [
    "The Demigod Files","The Sword of Hades"
  ]},
  { name: "Heroes of Olympus", items: [
    "The Lost Hero","The Son of Neptune","The Mark of Athena","The House of Hades","The Blood of Olympus"
  ]},
  { name: "Trials of Apollo", items: [
    "The Hidden Oracle","The Dark Prophecy","The Burning Maze","The Tyrantâ€™s Tomb","The Tower of Nero"
  ]},
  { name: "Magnus Chase", items: [
    "The Sword of Summer","The Hammer of Thor","The Ship of the Dead"
  ]},
  { name: "Riordan Misc", items: [
    "9 from the Nine Worlds","Demigods & Magicians","The Sun and The Star"
  ]},

  /* Shadowhunterverse */
  { name: "The Infernal Devices", items: [
    "Clockwork Angel","Clockwork Prince","Clockwork Princess"
  ]},
  { name: "The Last Hours", items: [
    "Chain of Gold","Chain of Iron","Chain of Thorns"
  ]},
  { name: "The Mortal Instruments", items: [
    "City of Bones","City of Ashes","City of Glass",
    "City of Fallen Angels","City of Lost Souls","City of Heavenly Fire"
  ]},
  { name: "The Dark Artifices", items: [
    "Lady Midnight","Lord of Shadows","Queen of Air and Darkness"
  ]},
  { name: "The Eldest Curses", items: [
    "The Red Scrolls of Magic","The Lost Book of the White",
    "The Black Volume of the Dead (upcoming)"
  ]},
  { name: "Shadowhunter Collections", items: [
    "The Bane Chronicles","Tales from the Shadowhunter Academy","Ghosts of the Shadow Market"
  ]}
];

/* ========= UTILITY ========= */

function uid(){ return Date.now().toString(36)+Math.random().toString(36).slice(2,8); }

/* ========= AUTO-REPAIR NOVELS INITIALIZATION ========= */

async function ensureNovels() {
  const novelsRef = db.collection("novels");
  const snap = await novelsRef.get();

  // If missing or incomplete â†’ rebuild
  if (snap.size !== defaultNovels.length) {

    // delete existing
    for (const doc of snap.docs){
      await novelsRef.doc(doc.id).delete();
    }

    // rebuild full list
    for (const series of defaultNovels){
      const docRef = novelsRef.doc();
      const items = {};
      series.items.forEach(title => items[uid()] = { title, checked:false });
      await docRef.set({ name: series.name, items });
    }

    console.log("NOVELS REBUILT âœ”");
  } else {
    console.log("Novels OK âœ”");
  }
}

/* ========= RENDERING ========= */

let unsubscribe = null;

function listen(){
  if (unsubscribe) unsubscribe();

  unsubscribe = db.collection(activeTab)
    .orderBy("name")
    .onSnapshot(snapshot => {
      const div = document.getElementById("content");
      div.innerHTML = "";

      snapshot.forEach(doc => renderSeries(doc.id, doc.data()));

      if (snapshot.empty){
        div.innerHTML = `<div class="group"><div class="group-title">No series found</div></div>`;
      }
    });
}

function renderSeries(id,data){
  const container = document.createElement("div");
  container.className="group";

  container.innerHTML = `
    <div class="group-title">
      ${data.name}
      <button class="danger" onclick="deleteSeries('${id}')">Delete</button>
    </div>
  `;

  const list = document.createElement("ul");
  list.className="checklist";

  Object.entries(data.items || {}).forEach(([key,val])=>{
    const li=document.createElement("li");
    li.className="item";

    li.innerHTML = `
      <input type="checkbox" ${val.checked ? "checked":""}
        onchange="toggleItem('${id}','${key}',this.checked)">
      <label class="item-label">${val.title}</label>
      <button onclick="removeItem('${id}','${key}')">Remove</button>
    `;

    list.appendChild(li);
  });

  container.appendChild(list);

  container.innerHTML += `
    <div class="add-row">
      <input id="add-${id}" placeholder="Add item...">
      <button onclick="addItem('${id}')">Add</button>
    </div>
  `;

  document.getElementById("content").appendChild(container);
}

/* ========= CRUD ========= */

function addSeries(){
  const name=document.getElementById("newSeries").value.trim();
  if(!name)return;
  db.collection(activeTab).add({name,items:{}});
  document.getElementById("newSeries").value="";
}

function deleteSeries(id){
  if(confirm("Delete series?"))
    db.collection(activeTab).doc(id).delete();
}

function addItem(seriesId){
  const input=document.getElementById("add-"+seriesId);
  const title=input.value.trim();
  if(!title)return;

  const id=uid();
  db.collection(activeTab).doc(seriesId).update({
    ["items."+id]:{title,checked:false}
  });

  input.value="";
}

function removeItem(seriesId,itemId){
  db.collection(activeTab).doc(seriesId).update({
    ["items."+itemId]:firebase.firestore.FieldValue.delete()
  });
}

function toggleItem(seriesId,itemId,checked){
  db.collection(activeTab).doc(seriesId).update({
    ["items."+itemId+".checked"]:checked
  });
}

/* ========= CHECK ALL ========= */

document.getElementById("checkAll").onclick=async()=>{
  const snap=await db.collection(activeTab).get();
  snap.forEach(doc=>{
    const update={};
    Object.keys(doc.data().items||{}).forEach(k=> update["items."+k+".checked"]=true);
    db.collection(activeTab).doc(doc.id).update(update);
  });
};

document.getElementById("uncheckAll").onclick=async()=>{
  const snap=await db.collection(activeTab).get();
  snap.forEach(doc=>{
    const update={};
    Object.keys(doc.data().items||{}).forEach(k=> update["items."+k+".checked"]=false);
    db.collection(activeTab).doc(doc.id).update(update);
  });
};

/* ========= TAB SWITCH ========= */

document.querySelectorAll(".tab").forEach(t=>{
  t.onclick=()=>{
    document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
    t.classList.add("active");
    activeTab=t.dataset.tab;
    listen();
  }
});

/* ========= INIT ========= */

(async()=>{
  await ensureNovels();
  listen();
})();
</script>
</body>
</html>
